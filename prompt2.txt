ENG. PROMPT & ENG. CONTEXTO

Anatomia de Prompts Eficazes: Conceitos e Funcionamento Detalhado


PADR√ïES DE EFETIVIDADE COMPROVADOS

1. Regra dos 4 Cs de Prompts Eficazes:

Claro: Instru√ß√µes sem ambiguidade
Conciso: Elimina redund√¢ncia, mant√©m essencial
Completo: Inclui todos os requisitos
Consistente: Padr√£o previs√≠vel nas respostas

2. Estrutura O-R-A (Objetivo-Regras-A√ß√£o):
OBJETIVO: O que deve ser alcan√ßado
REGRAS: Limita√ß√µes e condi√ß√µes
A√á√ÉO: Processo espec√≠fico a seguir


3. Hierarquia de Prioridades em System Prompts:

Seguran√ßa/√âtica (n√£o negoci√°vel)
Formato/Especifica√ß√£o (cr√≠tico para integra√ß√£o)
Dom√≠nio/Expertise (qualidade da resposta)
Estilo/Comunica√ß√£o (experi√™ncia do usu√°rio)

ESTRUTURA DE MENSAGENS: SYSTEM/USER/ASSISTANT

Sistemas de LLM modernos (especialmente OpenAI, Anthropic, etc.) utilizam um sistema de pap√©is hier√°rquico que organiza a conversa em tr√™s tipos de mensagens:

System Message (Mensagem do Sistema)

Prop√≥sito: Configurar o contexto permanente e as regras do comportamento do modelo

Caracter√≠sticas:
√â a primeira mensagem na conversa
Permanece vis√≠vel para o modelo durante todo o di√°logo
Define o comportamento base do assistente
N√£o recebe resposta direta do modelo

No projeto Agente de Not√≠cias de Seguran√ßa P√∫blica, o System Message consolidou as regras de neg√≥cio: foco no DF, uso de fontes policiais e o tom de intelig√™ncia estrat√©gica.

Exemplo de Prompt:

{
  "role": "system",
  "content": "Voc√™ √© o n√∫cleo de intelig√™ncia do AgenteNoticiasSegPub. Sua fun√ß√£o √© analisar dados de seguran√ßa p√∫blica do Distrito Federal. 
              REGRAS:
              1. Foco exclusivo em PMDF, PCDF, CBMDF e incidentes no DF.
              2. Extraia fatos: Local, Hora, Envolvidos e Desfecho.
              3. Identifique riscos ou tend√™ncias criminais.
              4. Formate a sa√≠da sempre em JSON estruturado para alimentar o banco SQLite.
              5. Tom: Profissional, t√©cnico e imparcial."
}

Resultado:
Definiu a persona (quem voc√™ √©)
Estabeleceu restri√ß√µes (o que n√£o fazer)
Especificou formata√ß√£o (como responder)
Configurou o tom e estilo

User Message (Mensagem do Usu√°rio)

Prop√≥sito: Representa a entrada do usu√°rio/humano

Caracter√≠sticas:
Cont√©m a pergunta ou instru√ß√£o atual
Pode incluir dados ou contexto espec√≠fico
√â o gatilho para uma resposta
Pode ser m√∫ltiplas mensagens em sequ√™ncia

Exemplo:
{
  "role": "user", 
  "content": "Resultados da busca web: [CONTE√öDO BRUTO DO DUCKDUCKGO]. 
              Com base nesses dados, gere o relat√≥rio de intelig√™ncia sobre a opera√ß√£o da PCDF em Ceil√¢ndia mencionada nos links."
}

Resultado: A User Message no neste projeto n√£o foi apenas uma pergunta, mas forneceu os dados brutos (vindos do DuckDuckGo ou RSS) para que a IA trabalhe.

Assistant Message (Mensagem do Assistente)

Prop√≥sito: Representa as respostas pr√©vias do modelo

Caracter√≠sticas:
Hist√≥rico de respostas anteriores
Mant√©m o contexto da conversa
Usado para few-shot learning (exemplos)
Pode demonstrar padr√µes de resposta

Exemplo (treinar o modelo dentro da conversa):
[
    {
      "role": "user", 
      "content": "Not√≠cia: 'PMDF apreende drogas no Gama nesta tarde'."
    },
    {
      "role": "assistant", 
      "content": "{\"status\": \"sucesso\", \"analise\": {\"forca\": \"PMDF\", \"local\": \"Gama\", \"incidente\": \"Apreens√£o de entorpecentes\"}}"
    },
    {
      "role": "user", 
      "content": "Not√≠cia: 'PCDF deflagra opera√ß√£o contra roubo de ve√≠culos em Taguatinga'."
    }
]

RESULTADO: Este projeto salva dados no SQLite, ent√£o a IA n√£o pode errar o formato do JSON. Usamos a Assistant Message para dar um exemplo (Few-Shot), ou seja, utilizamos uma t√©cnica eficaz para garantir que o Backend n√£o quebre.

PAPEL DO SYSTEM PROMPT NA DEFINI√á√ÉO DE COMPORTAMENTO

Funcionamento: O system prompt √© injetado virtualmente antes de cada intera√ß√£o, mantendo-se no contexto do modelo sem consumir tokens do limite da conversa principal em algumas implementa√ß√µes.

Componentes Estrat√©gicos de um System Prompt Eficaz:

A. Defini√ß√£o de Identidade (Persona)

system prompt = 
"""
Voc√™ √© 'AgenteSegPub-Core', um assistente especializado em:
1. Monitoramento de incidentes de seguran√ßa
2. An√°lise de tend√™ncias criminais
3. Identifica√ß√£o de fake news em seguran√ßa p√∫blica
4. Extra√ß√£o de metadados operacionais

Sua expertise inclui:
- Estrutura das for√ßas de seguran√ßa do DF (PMDF, PCDF, CBMDF)
- Tipifica√ß√£o penal b√°sica
- Geografia e regi√µes administrativas do Distrito Federal
"""
Resultado: Alinha o modelo com dom√≠nio espec√≠fico, melhorando precis√£o.

B. Regras de Comportamento (Constraints)

system prompt = 
"""
REGRAS ABSOLUTAS:
1. NUNCA invente fatos ou incidentes n√£o reportados
2. SEMPRE cite a fonte da not√≠cia (link original)
3. Ignore not√≠cias de outros estados fora do DF/Entorno
4. SEMPRE mantenha neutralidade pol√≠tica na an√°lise

LIMITA√á√ïES:
- Base de conhecimento atualizada at√© a data do modelo
- Foco em seguran√ßa p√∫blica e defesa civil
- N√£o realiza den√∫ncias formais, apenas an√°lise de dados p√∫blicos
"""
Resultado: Reduz alucina√ß√µes e mant√©m respostas dentro dos limites.

C. Instru√ß√µes de Processamento (Process)

system prompt = 
"""
PROCESSO DE AN√ÅLISE (siga sempre nesta ordem):
1. Filtragem: Identificar se √© not√≠cia de seguran√ßa no DF
2. Extra√ß√£o: Coletar Local, Data, Tipo de Crime, Envolvidos
3. Valida√ß√£o: Verificar credibilidade da fonte
4. Estrutura√ß√£o: Formatar o JSON para o banco de dados

ETAPAS OBRIGAT√ìRIAS:
- Normalizar nomes de regi√µes administrativas (ex: 'Ceil√¢ndia Norte' -> 'Ceil√¢ndia')
- Converter datas relativas ('hoje', 'ontem') para ISO8601
- Gerar resumo curto (snippet) para exibi√ß√£o mobile
"""

Resultado: Garante consist√™ncia e abordagem sistem√°tica.

D. Configura√ß√£o de Tom e Estilo (Tone)

system prompt = 
"""
CONFIGURA√á√ÉO DE COMUNICA√á√ÉO:
- Tom: Jornal√≠stico e Anal√≠tico
- P√∫blico-alvo: Analistas de intelig√™ncia e gestores
- N√≠vel t√©cnico: Intermedi√°rio (uso correto de termos policiais)
- Idioma: Portugu√™s brasileiro formal

DIRETRIZES DE RESPOSTA:
- Seja conciso e direto ao ponto (estilo 'Briefing')
- Use marcadores para listar ocorr√™ncias
- Destaque entidades importantes (nomes, locais) em **negrito**
- Inclua classifica√ß√£o de gravidade no in√≠cio
"""
Resultado: Adapta a comunica√ß√£o ao p√∫blico-alvo.

T√©cnicas Avan√ßadas de System Prompt

E. Prompt de M√∫ltiplas Camadas


system prompt = 
"""
# CAMADA 1: IDENTIDADE
Voc√™ √© um analista de intelig√™ncia de seguran√ßa p√∫blica.

# CAMADA 2: PROCESSAMENTO
Siga este fluxo: 
Coletar Not√≠cia ‚Üí Extrair Entidades ‚Üí Validar Geo-localiza√ß√£o ‚Üí Classificar Risco ‚Üí Gerar JSON

# CAMADA 3: VALIDA√á√ÉO
Antes de responder, verifique:
‚úì A not√≠cia √© realmente do DF?
‚úì O JSON gerado respeita o schema do banco de dados?
‚úì A data est√° no formato correto?
"""

F. Prompt Din√¢mico com Placeholders

system prompt = 
"""
Voc√™ √© um especialista em {forca_seguranca} (ex: PMDF, PCDF).
Sua tarefa √© analisar {tipo_incidente}.
O formato de resposta deve ser {formato_saida} (ex: JSON, Relat√≥rio PDF).
O n√≠vel de detalhe deve ser {nivel_detalhe} (ex: Estrat√©gico, Operacional).
"""

G. Prompt com Auto-reflex√£o

Exemplo de system prompt = 
"""
Antes de responder, pense:
1. Esta not√≠cia tem relev√¢ncia para a seguran√ßa p√∫blica?
2. A fonte √© confi√°vel ou parece sensacionalista?
3. Como posso estruturar os dados para facilitar a busca futura?
4. Quais campos do banco de dados (tabela 'noticias') s√£o obrigat√≥rios?

Ap√≥s pensar, gere apenas o JSON final.
"""

FORMATA√á√ÉO DE SA√çDA: T√âCNICAS AVAN√áADAS


H. JSON (JavaScript Object Notation)

Vantagens: Estrutura parse√°vel, ideal para integra√ß√£o com sistemas (Backend FastAPI)

Como usar:

Schema expl√≠cito: Defina exatamente a estrutura esperada (Pydantic Models)

Tipos de dados: Especifique string, number, boolean, array

Enums limitados: Use valores pr√©-definidos quando poss√≠vel

Exemplo m√≠nimo: Inclua exemplo se o schema for complexo

```python
Prompt=
"""
Extraia as informa√ß√µes da not√≠cia policial abaixo.

NOT√çCIA: {texto_noticia}

FORMATO DE RESPOSTA (JSON v√°lido para API):
{
    "incidentes": [
        {
            "titulo": "string",
            "tipo_crime": "Roubo|Homic√≠dio|Tr√°fico|Outro",
            "localizacao": {
                "cidade": "string (RA do DF)",
                "bairro": "string"
            }
        }
    ],
    "data_ocorrencia": "YYYY-MM-DDTHH:MM:SS",
    "envolvidos": {
        "vitimas": "int (estimado)",
        "suspeitos_presos": "int"
    },
    "nivel_risco": "alto|medio|baixo",
    "resumo_analitico": "string"
}

RESPONDA APENAS COM O JSON:
"""
```

I. XML (eXtensible Markup Language)

Vantagens: Hierarquia clara, namespaces, valida√ß√£o via XSD

```python
Prompt=
"""
Analise o boletim de ocorr√™ncia e retorne no formato XML:

<analise_boletim>
    <metadata>
        <origem>PMDF</origem>
        <data_processamento>ISO8601</data_processamento>
    </metadata>
    <ocorrencia tipo="patrimonial|vida">
        <natureza>string</natureza>
        <local>
             <ra>Ceil√¢ndia</ra>
             <logradouro>QNN 03</logradouro>
        </local>
    </ocorrencia>
    <desfecho>
        <status>Preso em Flagrante</status>
        <apreencoes>
            <item>Arma de Fogo</item>
            <qtd>1</qtd>
        </apreencoes>
    </desfecho>
</analise_boletim>

Boletim: {texto}
"""
```

J. Markdown

Vantagens: Legibilidade humana, rico em formata√ß√£o, amplamente suportado (Frontend Streamlit)

```python
Exemplo de prompt:
# Gerar relat√≥rio para visualiza√ß√£o no Streamlit

"""
Analise os dados de criminalidade da semana e formate a resposta em Markdown:

# üìä Relat√≥rio Semanal de Seguran√ßa - {regiao_admin}

## üîç **Panorama Geral**
{resumo_conciso_situacao}

## üìà **Indicadores Chave**
| Natureza | Qtd | Tend√™ncia | Observa√ß√£o |
|----------|-----|-----------|------------|
| Roubo a Pedestre | {valor} | {seta} | {texto} |
| Tr√°fico | {valor} | {seta} | {texto} |

## ‚ö†Ô∏è **Pontos de Aten√ß√£o (Hotspots)**
### Risco Elevado
- **{local1}**: {motivo_alerta}

### Monitoramento
- {local2}

## ‚úÖ **A√ß√µes Recomendadas**
1. **Prioridade**: {acao1}
2. Sugest√£o: {acao2}

## üìé **Fontes Analisadas**
"""
```

L. T√©cnicas H√≠bridas e Estrat√©gicas 

L1. Formata√ß√£o Condicional

```python
prompt = """
Se a entrada for uma not√≠cia estruturada (API), use JSON.
Se for um resumo para o usu√°rio (Chat), use Markdown.
Se for um log de erro do sistema, use XML.

Estrutura JSON para DB:
{json_news_item_schema}

Estrutura Markdown para Chat:
{markdown_chat_template}

Entrada: {input_data}
"""
```

L2. Delimitadores Expl√≠citos

```python
prompt = """
Comece sua resposta com: ###INICIO_JSON###
Termine sua resposta com: ###FIM_JSON###

Entre esses delimitadores, forne√ßa apenas JSON v√°lido para o Backend:

{
    "id": "hash_sha256",
    "title": "string",
    "url": "string",
    "publishedAt": "datetime",
    "source": "string",
    "snippet": "string"
}

Analise: {texto_noticia}
"""
```

L3. Templates com Placeholders

```python
prompt = """
Preencha o template de Briefing Di√°rio abaixo:

BRIEFING DE SEGURAN√áA - INTELLIGENCE HUB
========================================
ID Relat√≥rio: {id_gerado}
Data: {data_hoje}

RESUMO EXECUTIVO:
{resumo_3_linhas}

DESTAQUES OPERACIONAIS (Top 3):
1. {destaque1}
2. {destaque2}
3. {destaque3}

TEND√äNCIA DO DIA:
{analise_tendencia}

GRAU DE NORMALIDADE: {status_operacional}

Fontes: {lista_fontes}

Preencha {campo} com informa√ß√µes extra√≠das do Feed RSS.
"""
```


M. EXEMPLO COMPLETO INTEGRADO

OBS: O modelo responder√° como "assistant" seguindo as diretrizes


```python
# SYSTEM PROMPT (defini√ß√£o de comportamento)
system_message = {
    "role": "system",
    "content": """
    Voc√™ √© 'SegPub-AI', o motor de intelig√™ncia do AgenteNoticiasSegPub.
    
    MISS√ÉO: Transformar not√≠cias brutas em intelig√™ncia acion√°vel para o Banco de Dados.
    
    REGRAS ABSOLUTAS:
    1. Nunca altere a URL ou T√≠tulo original da not√≠cia
    2. Normalize as datas para UTC
    3. Categorize a not√≠cia: 'Cr√≠tica', 'Alerta', 'Informativa'
    4. Ignore conte√∫do de entretenimento ou esportes
    
    PROCESSO PADR√ÉO:
    1. Ler t√≠tulo e snippet
    2. Identificar se √© seguran√ßa p√∫blica (Filtro)
    3. Extrair metadados (Data, Fonte)
    4. Gerar JSON compat√≠vel com `NewsItem`
    
    FORMATA√á√ÉO:
    - Use Markdown quando falar com o usu√°rio no Chat
    - Use JSON estrito quando salvar no Banco de Dados
    
    TOM: Objetivo, t√©cnico, sem sensacionalismo.
    """
}

# USER PROMPT (tarefa espec√≠fica)
user_message = {
    "role": "user",
    "content": """
    Analise o feed RSS abaixo e retorne o JSON para inser√ß√£o no SQLite.
    
    FORMATO EXATO REQUERIDO (Lista de NewsItem):
    ```json
    [
        {
            "id": "string (hash)",
            "title": "string",
            "url": "string",
            "publishedAt": "ISO8601",
            "source": "string",
            "snippet": "string",
            "analise_ia": {
                "categoria": "string",
                "risco": "alto|medio|baixo"
            }
        }
    ]
    ```
    FEED RSS:
    [CONTE√öDO DO FEED GOOGLE NEWS AQUI]
    """
}
```
.
